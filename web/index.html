<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video game sales VP</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="jumbotron">
        <div class="container-fluid">
            <!-- Ovdje je header dio -->
            <div class="d-flex flex-wrap">
                <div class="mr-auto">
                    <img src="./src/ferit.png" alt="Ferit logo" height="200">
                </div>
                <div class="pt-3 mr-auto">
                    <h1>Video game sales</h1>
                </div>
                <div class="ml-auto">
                    <div class="card">
                        <div class="card-header">Current settings:</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col card">
                                    <p id="textGenreLeft">Genre left: #</p>
                                    <p id="textPlatformLeft">Platform left: #</p>
                                </div>
                                <div class="col card">
                                    <p id="textGenreRight">Genre right: #</p>
                                    <p id="textPlatformRight">Platform right: #</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <p id="textRegion">Region: #</p>
                        </div>
                    </div>
                </div>
                <div>
                    <ul class="list-group justify-content-end">
                        <li class="list-group-item text-body">
                            <button class="btn dropdown-toggle" type="button" id="dropdownMenuButtonRegion"
                                data-toggle="dropdown">Region</button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonRegion">
                                <a class="dropdown-item" id="buttonGlobal">Global</a>
                                <a class="dropdown-item" id="buttonNA">North America</a>
                                <a class="dropdown-item" id="buttonPAL">Europe</a>
                                <a class="dropdown-item" id="buttonJP">Japan</a>
                            </div>
                        </li>
                        <li class="list-group-item text-body">
                            <button class="btn dropdown-toggle" type="button" id="dropdownMenuButtonGraphType" data-toggle="dropdown">GraphType</button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonGraphType">
                                <a class="dropdown-item" id="buttonGraphTypePie">Pie</a>
                                <a class="dropdown-item" id="buttonGraphTypeBarplot">Barplot</a>
                                <a class="dropdown-item" id="buttonGraphTypeTreemap">Treemap</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="container-fluid">
            <div class="row">
                <div class="col">
                    <!-- Ovdje pocinje svg dio -->
                    <div class="row">
                        <div class="col-xl-6">
                            <div class="card">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-9" id="svgContainerLeft"></div>
                                        <div class="col-md-3">
                                            <ul class="list-group list-group-horizontal justify-content-end p-1">
                                                <li class="list-group-item text-body">
                                                    <button class="btn dropdown-toggle" type="button" id="dropdownMenuButtonGenre" data-toggle="dropdown">Genre</button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonGenre">
                                                        <a class="dropdown-item" id="leftButtonAction">Action</a>
                                                        <a class="dropdown-item" id="leftButtonActionAdventure">Action-Adventure</a>
                                                        <a class="dropdown-item" id="leftButtonAdventure">Adventure</a>
                                                        <a class="dropdown-item" id="leftButtonFighting">Fighting</a>
                                                        <a class="dropdown-item" id="leftButtonMisc">Miscellaneous</a>
                                                        <a class="dropdown-item" id="leftButtonMusic">Music</a>
                                                        <a class="dropdown-item" id="leftButtonParty">Party</a>
                                                        <a class="dropdown-item" id="leftButtonPlatform">Platform</a>
                                                        <a class="dropdown-item" id="leftButtonPuzzle">Puzzle</a>
                                                        <a class="dropdown-item" id="leftButtonRacing">Racing</a>
                                                        <a class="dropdown-item" id="leftButtonRolePlaying">Role-Playing</a>
                                                        <a class="dropdown-item" id="leftButtonShooter">Shooter</a>
                                                        <a class="dropdown-item" id="leftButtonSimulation">Simulation</a>
                                                        <a class="dropdown-item" id="leftButtonSports">Sports</a>
                                                        <a class="dropdown-item" id="leftButtonStrategy">Strategy</a>
                                                    </div>
                                                </li>
                                                <li class="list-group-item text-body">
                                                    <button class="btn dropdown-toggle" type="button" id="dropdownMenuButtonPlatform" data-toggle="dropdown">Platform</button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonPlatform">
                                                        <a class="dropdown-item" id="leftButtonN64">Nintendo 64</a>
                                                        <a class="dropdown-item" id="leftButtonSNES">Super Nintendo Entertainment System</a>
                                                        <a class="dropdown-item" id="leftButtonNS">Nintendo Switch</a>
                                                        <a class="dropdown-item" id="leftButtonWii">Wii</a>
                                                        <a class="dropdown-item" id="leftButtonWiiU">WiiU</a>
                                                        <a class="dropdown-item" id="leftButtonPS">PlayStation</a>
                                                        <a class="dropdown-item" id="leftButtonPS2">PlayStation 2</a>
                                                        <a class="dropdown-item" id="leftButtonPS3">PlayStation 3</a>
                                                        <a class="dropdown-item" id="leftButtonPS4">PlayStation 4</a>
                                                        <a class="dropdown-item" id="leftButtonPSV">PlayStation Vita</a>
                                                        <a class="dropdown-item" id="leftButtonX360">Xbox 360</a>
                                                        <a class="dropdown-item" id="leftButtonXONE">Xbox One</a>
                                                        <a class="dropdown-item" id="leftButtonPC">PC</a>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-xl-6">
                            <div class="card">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-md-9" id="svgContainerRight"></div>
                                        <div class="col-md-3">
                                            <ul class="list-group list-group-horizontal justify-content-end p-1">
                                                <li class="list-group-item text-body">
                                                    <button class="btn dropdown-toggle" type="button" id="dropdownMenuButtonGenre" data-toggle="dropdown">Genre</button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonGenre">
                                                        <a class="dropdown-item" id="rightButtonAction">Action</a>
                                                        <a class="dropdown-item" id="rightButtonActionAdventure">Action-Adventure</a>
                                                        <a class="dropdown-item" id="rightButtonAdventure">Adventure</a>
                                                        <a class="dropdown-item" id="rightButtonFighting">Fighting</a>
                                                        <a class="dropdown-item" id="rightButtonMisc">Miscellaneous</a>
                                                        <a class="dropdown-item" id="rightButtonMusic">Music</a>
                                                        <a class="dropdown-item" id="rightButtonParty">Party</a>
                                                        <a class="dropdown-item" id="rightButtonPlatform">Platform</a>
                                                        <a class="dropdown-item" id="rightButtonPuzzle">Puzzle</a>
                                                        <a class="dropdown-item" id="rightButtonRacing">Racing</a>
                                                        <a class="dropdown-item" id="rightButtonRolePlaying">Role-Playing</a>
                                                        <a class="dropdown-item" id="rightButtonShooter">Shooter</a>
                                                        <a class="dropdown-item" id="rightButtonSimulation">Simulation</a>
                                                        <a class="dropdown-item" id="rightButtonSports">Sports</a>
                                                        <a class="dropdown-item" id="rightButtonStrategy">Strategy</a>
                                                    </div>
                                                </li>
                                                <li class="list-group-item text-body">
                                                    <button class="btn dropdown-toggle" type="button" id="dropdownMenuButtonPlatform" data-toggle="dropdown">Platform</button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonPlatform">
                                                        <a class="dropdown-item" id="rightButtonN64">Nintendo 64</a>
                                                        <a class="dropdown-item" id="rightButtonSNES">Super Nintendo Entertainment System</a>
                                                        <a class="dropdown-item" id="rightButtonNS">Nintendo Switch</a>
                                                        <a class="dropdown-item" id="rightButtonWii">Wii</a>
                                                        <a class="dropdown-item" id="rightButtonWiiU">WiiU</a>
                                                        <a class="dropdown-item" id="rightButtonPS">PlayStation</a>
                                                        <a class="dropdown-item" id="rightButtonPS2">PlayStation 2</a>
                                                        <a class="dropdown-item" id="rightButtonPS3">PlayStation 3</a>
                                                        <a class="dropdown-item" id="rightButtonPS4">PlayStation 4</a>
                                                        <a class="dropdown-item" id="rightButtonPSV">PlayStation Vita</a>
                                                        <a class="dropdown-item" id="rightButtonX360">Xbox 360</a>
                                                        <a class="dropdown-item" id="rightButtonXONE">Xbox One</a>
                                                        <a class="dropdown-item" id="rightButtonPC">PC</a>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="card mb-2 mt-2">
                        <div class="card-header" id="textClickedGameTitle">
                            <div id="loaderSpinner"></div>Game: click on a member of the pie chart to display more data
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered" id="tableClicked">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Genre</th>
                                        <th>ESRB rating</th>
                                        <th>Platform</th>
                                        <th>Publisher</th>
                                        <th>Developer</th>
                                        <th>Region sales</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>N/A</td>
                                        <td>N/A</td>
                                        <td>N/A</td>
                                        <td>N/A</td>
                                        <td>N/A</td>
                                        <td>N/A</td>
                                        <td>N/A</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="card-footer">
                            <p class="text-danger">Warning! Will lag considering the dataset is several MB in size and
                                dataframe-js doesn't play well with such sizes</p>
                            <p>Made by Anto Tufeković, <a href="https://github.com/ATufekovic/VP_projekt"
                                    target="_blank">GitHub</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://gmousse.github.io/dataframe-js/dist/dataframe.min.js"></script>
<script>
    var DataFrame = dfjs.DataFrame;

    class DataManipulator {
        /**
     * Klasa koja obavlja sve poslove vezane za manipulaciju podatcima te prikazom u grafickom obliku - podrzano samo pie graph i csv datoteke
    */
        constructor(verbose = false) {
            this.data = null;
            this.verbose = verbose;

            this.genres = ["Action", "ActionAdventure", "Adventure", "Fighting", "Misc", "Music", "Party", "Platform", "Puzzle", "Racing", "Shooter", "Simulation", "Sports", "Strategy"];
            this.genreButtonsLeft = [];
            this.genreButtonsRight = [];
            this.selectedGenreLeft = "Action";
            this.selectedGenreRight = "Adventure";

            this.platforms = ["N64", "SNES", "NS", "Wii", "WiiU", "PS", "PS2", "PS3", "PS4", "PSV", "X360", "XONE", "PC"];
            this.platformButtonsLeft = [];
            this.platformButtonsRight = [];
            this.selectedPlatformLeft = "N64";
            this.selectedPlatformRight = "SNES";

            this.regions = ["Global", "NA", "PAL", "JP"];
            this.regionButtons = [];
            this.selectedRegion = "Global";

            this.graphTypes = ["Pie", "Barplot", "Treemap"];
            this.graphTypeButtons = [];
            this.selectedGraphType = "Barplot";

            this.settingInfoTextLeft = [];
            this.settingInfoTextRight = [];
            this.settingInfoTextRegion = null;

            this.spinner = null;

            this.svgContainerLeft = null;
            this.svgContainerRight = null;

            this.tableClicked = null;
            this.textClickedGameTitle = null;
        }
        /**
         * Funkcija koja bi se trebala pozivati nakon kreiranje klase da bi se pokrenuo proces dohvacanja svih potrebnih elemenata.
        */
        init() {
            //ucitaj podatke koristeci dataframe-js biblioteku
            DataFrame.fromCSV("src/smol.csv").then(df => {
                this.data = df.select('Name', 'Genre', 'ESRB_Rating', 'Platform', 'Publisher', 'Developer', 'Global_Sales', 'NA_Sales', 'PAL_Sales', 'JP_Sales', 'Year');
                if (this.verbose) {
                    console.log("Loaded " + this.data.count() + " row(s) into data");
                    console.log("Example:");
                    this.data.head(3).show();
                }
                //nakon ucitavanja pocni sve ostale elemente dohvacati i rijesi tipke

                this.setEvents();

                this.settingInfoTextRegion = document.querySelector("#textRegion");

                let settingGenreLeft = document.querySelector("#textGenreLeft");
                let settingPlatformLeft = document.querySelector("#textPlatformLeft");

                let settingGenreRight = document.querySelector("#textGenreRight");
                let settingPlatformRight = document.querySelector("#textPlatformRight");

                this.settingInfoTextLeft.push(settingGenreLeft, settingPlatformLeft);
                this.settingInfoTextRight.push(settingGenreRight, settingPlatformRight);


                this.spinner = document.querySelector("#loaderSpinner");
                this.svgContainerLeft = document.querySelector("#svgContainerLeft");
                this.svgContainerRight = document.querySelector("#svgContainerRight");
                this.tableClicked = document.querySelector("#tableClicked");
                this.textClickedGameTitle = document.querySelector("#textClickedGameTitle");

                this.graphWidth = 700;
                this.graphHeight = 700;

                if (this.verbose) { console.log(this.settingInfoTextLeft); }

                //na kraju se prikaz osvježava
                this.updateDisplay("ALL");
            });
        }
        /**
         * Funkcija koja ide po tipkama u dropdown menu-ima te svaku tipku sa pripadajucim vrijednostima prosljedjuje dalje funkciji koja obraduje tipke
        */
        setEvents() {
            this.genres.forEach(genre => {
                let temp = document.querySelector("#leftButton" + genre);
                this.eventClickHandlerChange(temp, "genre", genre, "L");
                this.genreButtonsLeft.push(temp);

                temp = document.querySelector("#rightButton" + genre);
                this.eventClickHandlerChange(temp, "genre", genre, "R");
                this.genreButtonsRight.push(temp);
            });

            this.platforms.forEach(platform => {
                let temp = document.querySelector("#leftButton" + platform);
                this.eventClickHandlerChange(temp, "platform", platform, "L");
                this.platformButtonsLeft.push(temp);

                temp = document.querySelector("#rightButton" + platform);
                this.eventClickHandlerChange(temp, "platform", platform, "R");
                this.platformButtonsRight.push(temp);
            });

            this.regions.forEach(region => {
                let temp = document.querySelector("#button" + region);
                this.eventClickHandlerChange(temp, "region", region, "button");
                this.regionButtons.push(temp);
            });
            if (this.verbose) { console.log(this.regionButtons); }

            this.graphTypes.forEach(graphType => {
                let temp = document.querySelector("#buttonGraphType" + graphType);
                this.eventClickHandlerChange(temp, "graphType", graphType, "button");
                this.graphTypeButtons.push(temp);
            });
        }
        /**
         * Funkcija koja danoj tipci daje on click event ovisno o proslijedjenim varijablama te tada mijenjaju trenutno odabrane varijable za prikaz
        */
        eventClickHandlerChange(button, type, value, LR) {
            if (LR == "L") {
                if (type == "genre") {
                    button.addEventListener("click", (e) => {
                        this.selectedGenreLeft = value;
                        this.updateDisplay("L");
                    });
                } else if (type == "platform") {
                    button.addEventListener("click", (e) => {
                        this.selectedPlatformLeft = value;
                        this.updateDisplay("L");
                    });
                } else {
                    console.log("Something went wrong with setting on click events with following parameters (button, type, value):");
                    console.log(button);
                    console.log(type);
                    console.log(value);
                }
            } else if (LR == "R"){
                if (type == "genre") {
                    button.addEventListener("click", (e) => {
                        this.selectedGenreRight = value;
                        this.updateDisplay("R");
                    });
                } else if (type == "platform") {
                    button.addEventListener("click", (e) => {
                        this.selectedPlatformRight = value;
                        this.updateDisplay("R");
                    });
                } else {
                    console.log("Something went wrong with setting on click events with following parameters (button, type, value):");
                    console.log(button);
                    console.log(type);
                    console.log(value);
                }
            } else if (LR == "button") {
                if (type == "region") {
                    button.addEventListener("click", (e) => {
                        this.selectedRegion = value;
                        this.updateDisplay("ALL");
                    });
                } else if(type == "graphType"){
                    button.addEventListener("click", (e) => {
                        this.selectedGraphType = value;
                        this.updateDisplay("ALL");
                    });
                } else {
                    console.log("Something went wrong with setting on click events with following parameters (button, type, value):");
                    console.log(button);
                    console.log(type);
                    console.log(value);
                }
            } else {
                console.log("Something went wrong with setting on click events with following parameters (button, type, value):");
                console.log(button);
                console.log(type);
                console.log(value);
            }
        }
        /**
         * Funkcija koja osvježava sadrzaj stranice jednom, mijenja prikaz odabranih varijabli te sam graf
        */
        updateDisplay(LR) {
            this.settingInfoTextLeft[0].innerHTML = "Genre left: " + this.selectedGenreLeft;
            this.settingInfoTextLeft[1].innerHTML = "Platform left: " + this.selectedPlatformLeft;

            this.settingInfoTextRight[0].innerHTML = "Genre left: " + this.selectedGenreRight;
            this.settingInfoTextRight[1].innerHTML = "Platform left: " + this.selectedPlatformRight;

            this.settingInfoTextRegion.innerHTML = "Region: " + this.selectedRegion;

            if(LR == "ALL"){
                let dataArrayLeft = this.getTopTenFromData("L");
                let dataArrayRight = this.getTopTenFromData("R");
                this.showGraph(dataArrayLeft, "L");
                this.showGraph(dataArrayRight, "R");
            } else if (LR == "L"){
                let dataArrayLeft = this.getTopTenFromData("L");
                this.showGraph(dataArrayLeft, "L");
            } else if (LR == "R"){
                let dataArrayRight = this.getTopTenFromData("R");
                this.showGraph(dataArrayRight, "R");
            }
        }
        /**
         * Funkcija koja odabire potrebne stupce iz baze podataka te proslijeduje prvih deset (ili manje) natrag
        */
        getTopTenFromData(LR) {
            let temp = null;
            if(LR == "L"){
                temp = this.data.select('Name', 'Genre', 'ESRB_Rating', 'Platform', 'Publisher', 'Developer', this.selectedRegion + '_Sales', 'Year').filter({ 'Genre': this.selectedGenreLeft, 'Platform': this.selectedPlatformLeft }).filter(row => row.get(this.selectedRegion + '_Sales') != "");
            } else if (LR == "R"){
                temp = this.data.select('Name', 'Genre', 'ESRB_Rating', 'Platform', 'Publisher', 'Developer', this.selectedRegion + '_Sales', 'Year').filter({ 'Genre': this.selectedGenreRight, 'Platform': this.selectedPlatformRight }).filter(row => row.get(this.selectedRegion + '_Sales') != "");
            } else {
                console.log("oof, something went wrong...");
                return null;
            }

            if (this.verbose) {
                console.log("Gotten " + temp.count() + " row(s) of data");
                console.log(temp.head(10).toArray());
            }

            return temp.head(10).toArray();
        }
        /**
         * Funkcija koja prvo provjerava dali svg kontejner ima clanove, ako da obrisi ih, nakon toga stvara novi svg element sa grafom koji sadrzi vrijednosti proslijedjenih podataka
        */
        showGraph(dataArray, LR) {
            if (LR == "L") {
                if (this.svgContainerLeft.hasChildNodes()) {
                    this.svgContainerLeft.innerHTML = "";
                }
            }
            if (LR == "R") {
                if (this.svgContainerRight.hasChildNodes()) {
                    this.svgContainerRight.innerHTML = "";
                }
            }

            if(this.selectedGraphType == "Pie") {
                this.showPie(dataArray, LR);
            } else if (this.selectedGraphType == "Barplot"){
                this.showBarplot(dataArray, LR);
            }
        }

        showPie(dataArray, LR) {
            let width = this.graphWidth;
            let height = this.graphHeight;
            let outerRadius = (Math.min(width, height) / 2) * 0.95;
            let innerRadius = 0;
            let color = d3.scaleOrdinal(["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"]);

            let svg = null;
            if (LR == "L") {
                svg = d3.select("#svgContainerLeft")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
            } else if (LR == "R") {
                svg = d3.select("#svgContainerRight")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
            } else {
                console.log("oof, something went wrong...");
            }

            let pie = d3.pie()
                .value(d => parseFloat((d[6]).replace(',', '.')))
                .sort(null);

            let arc = d3.arc()
                .innerRadius(innerRadius)
                .outerRadius(outerRadius);

            let pieArcs = svg.selectAll("g.pie")
                .data(pie(dataArray))
                .enter()
                .append("g")
                .attr("class", "pie")
                .attr("transform", "translate(" + (width / 2) + ", " + (height / 2) + ")");

            pieArcs.append("path")
                .attr("fill", function (d, i) { return color(i); })
                .attr("d", arc);

            let pieArcsText = svg.selectAll("g.text")
                .data(pie(dataArray))
                .enter()
                .append("g")
                .attr("class", "pieText")
                .attr("transform", "translate(" + (width / 2) + ", " + (height / 2) + ")");

            pieArcsText.append("text")
                .attr("transform", function (d) {
                    var sum = 0.0;
                    var pi = Math.PI;
                    sum += d.endAngle + d.startAngle;
                    sum /= 2;
                    sum *= (180 / pi);
                    if (sum < 180) {
                        sum -= 90;
                    }
                    else if (sum >= 180) {
                        sum += 90;
                    }
                    return "translate(" + arc.centroid(d) + ") rotate(" + sum + ")";
                })
                .attr("text-anchor", "middle")
                .attr("class", "text")
                .text(function (d) { return d.data[0] + ": " + d.data[6] + "M"; });

            pieArcs.on("click", (d) => {
                if (this.verbose) { console.log(d.data); }
                let temp = "<td>" + d.data[0] + "</td>" + "<td>" + d.data[1] + "</td>" + "<td>" + d.data[2] + "</td>" + "<td>" + d.data[3] + "</td>" + "<td>" + d.data[4] + "</td>" + "<td>" + d.data[5] + "</td>" + "<td>" + d.data[6] + " Million units</td>";
                this.tableClicked.rows[1].innerHTML = temp;
                this.textClickedGameTitle.innerHTML = "<div id='loaderSpinner'></div>Game: " + d.data[0];
            });

        }
        showBarplot(dataArray, LR){
            let margin = {top:30, right:30, bottom:40, left:60};
            let width = this.graphWidth - margin.left - margin.right;
            let height = this.graphHeight - margin.top - margin.bottom;

            let svg = null;
            if (LR == "L") {
                svg = d3.select("#svgContainerLeft")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            } else if (LR == "R") {
                svg = d3.select("#svgContainerRight")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            } else {
                console.log("oof, something went wrong...");
            }

            //koristi se sljedeca funkcija da se dobije max nekog stupca (sedmog u ovom slucaju) 2D matrice
            //console.log(Math.max.apply(Math, dataArray.map(v => parseFloat(v[6].replace(",",".")))));

            let barPadding = 3;
            let barWidth = width/dataArray.length - barPadding;

            let x = d3.scaleBand()
                .domain(dataArray.map((d,i)=>{return i;}))
                .rangeRound([0, width]);
            
            let y = d3.scaleLinear()
                .domain([0, Math.max.apply(Math, dataArray.map(row => parseFloat(row[6].replace(",","."))))])
                .rangeRound([height, 0]);
            
            let xAxis = d3.axisBottom(x).tickValues(dataArray.map(row => row[0]));
            let yAxis = d3.axisLeft(y).ticks(dataArray.length);aaaaaaaaaaaaaaa

            let color = d3.scaleOrdinal(["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"]);

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .selectAll("text")
                .style("text-anchor", "middle");
            
            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis);
            
            svg.append("g")
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height/2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Sales");
            
            let barchart = svg.selectAll("rect")
                .data(dataArray)
                .enter()
                .append("rect")
                .attr("x", (d,i)=>{return x(i);})
                .attr("y", y)
                .attr("height", (d)=>{return height - y(parseFloat(d[6].replace(",",".")))})
                .attr("width", barWidth)
                .attr("fill", (d,i)=>{return color(i)});
        }
    }
    let dm = new DataManipulator(true);
    dm.init();
</script>

</html>